<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radhika Collection - Premium Product Details</title>
    
    <link rel="icon" type="image/png" href="https://img.freepik.com/premium-vector/shopping-logo-vector-icon_636116-200.jpg?semt=ais_hybrid&w=740&q=80"> 
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --primary: #f3047c; --dark: #333; --light-bg: #fdf2ff; --green: #1aab2a; }
        body { font-family: 'Poppins', sans-serif; margin: 0; background: #fff; color: #333; }
        header { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: white; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .gallery-section { padding: 10px; background: #fff; }
        .main-img-box { width: 100%; height: 420px; border-radius: 15px; overflow: hidden; background: #f9f9f9; display: flex; align-items: center; justify-content: center; border: 1px solid #eee; }
        .main-img-box img { width: 100%; height: 100%; object-fit: contain; }
        .thumb-row { display: flex; gap: 10px; margin-top: 12px; overflow-x: auto; padding: 5px; scrollbar-width: none; }
        .thumb-card { min-width: 75px; height: 75px; border-radius: 10px; border: 2px solid #eee; overflow: hidden; cursor: pointer; transition: 0.3s; }
        .thumb-card.active { border-color: var(--primary); transform: scale(1.05); }
        .thumb-card img { width: 100%; height: 100%; object-fit: cover; }
        .content-box { padding: 20px; }
        .brand-label { color: var(--primary); font-weight: 800; font-size: 13px; text-transform: uppercase; letter-spacing: 1.5px; }
        .rating-badge { background: var(--green); color: white; padding: 3px 10px; border-radius: 6px; font-size: 14px; font-weight: 700; display: inline-flex; align-items: center; gap: 5px; }
        .price-container { margin: 15px 0; display: flex; align-items: center; gap: 12px; }
        .current-price { font-size: 26px; font-weight: 800; color: #1a1a1a; }
        .old-price { font-size: 18px; color: #999; text-decoration: line-through; }
        .off-tag { background: #e74c3c; color: white; font-size: 14px; font-weight: 700; padding: 4px 10px; border-radius: 6px; }
        .feedback-section { margin-top: 25px; border-top: 1px solid #eee; padding-top: 20px; }
        .review-card { background: #fcfcfc; border: 1px solid #f0f0f0; padding: 15px; border-radius: 12px; margin-bottom: 12px; }
        .review-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .reviewer-name { font-weight: 700; font-size: 14px; }
        .review-stars { color: #f1c40f; font-size: 11px; }
        .review-text { font-size: 13px; color: #555; line-height: 1.5; }
        .bottom-bar { position: fixed; bottom: 0; width: 100%; background: white; display: flex; padding: 12px; gap: 10px; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); box-sizing: border-box; z-index: 1000; }
        .btn { flex: 1; height: 52px; border: none; border-radius: 10px; font-weight: 800; font-size: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-cart { background: #222; color: white; }
        .btn-buy { background: var(--primary); color: white; }
        .related-section { padding: 20px; border-top: 8px solid #f5f5f5; margin-bottom: 100px; }
        .related-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .rel-card { background: white; border-radius: 12px; overflow: hidden; border: 1px solid #eee; cursor: pointer; }
        .rel-card img { width: 100%; height: 180px; object-fit: cover; }
        
        /* Loading overlay for shared links */
        #loader { position: fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:9999; display:flex; align-items:center; justify-content:center; flex-direction:column; }
        .spinner { width:40px; height:40px; border:4px solid #f3f3f3; border-top:4px solid var(--primary); border-radius:50%; animation:spin 1s linear infinite; }
        @keyframes spin { 0% { transform:rotate(0deg); } 100% { transform:rotate(360deg); } }
    </style>
</head>
<body>

    <div id="loader"><div class="spinner"></div><p>Loading Product...</p></div>

    <header>
        <i class="fa-solid fa-arrow-left" onclick="history.back()" style="font-size: 20px;"></i>
        <h3 style="font-weight: 800; color: var(--primary); margin:0; letter-spacing:1px;">RADHIKA COLLECTION</h3>
        <div onclick="window.location.href='cart.html'" style="position: relative;">
            <i class="fa-solid fa-bag-shopping" style="font-size: 24px;"></i>
            <span id="badge" style="position: absolute; top:-5px; right:-8px; background:var(--primary); color:white; border-radius:50%; width:18px; height:18px; font-size:10px; display:none; align-items:center; justify-content:center;">0</span>
        </div>
    </header>

    <div class="gallery-section">
        <div class="main-img-box" id="mainBox"><img id="mainDisplay" src="" alt="Loading..."></div>
        <div class="thumb-row" id="thumbRow"></div>
    </div>

    <div class="content-box">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <span class="brand-label">Radhika Premium Collection</span>
            <div class="rating-badge"><span id="avgRating">4.4</span> <i class="fa-solid fa-star"></i></div>
        </div>
        <h1 id="pName" style="font-size: 22px; margin: 12px 0 5px 0; font-weight: 600;">Loading...</h1>
        <div class="price-container">
            <span class="current-price" id="pPrice">â‚¹0</span>
            <span class="old-price" id="pOld">â‚¹0</span>
            <span class="off-tag" id="pOff">0% OFF</span>
        </div>
        <div id="sizeArea" style="display:none; margin-bottom: 20px;">
            <p style="font-weight: 700; font-size: 14px; margin-bottom: 10px;">Select Size:</p>
            <div id="sizeOptions" style="display:flex; gap:10px; flex-wrap:wrap;"></div>
        </div>
        <div style="background: var(--light-bg); padding: 15px; border-radius: 12px; margin: 20px 0;">
            <table style="width: 100%; font-size: 13px; border-spacing: 0 8px;">
                <tr><td style="color:#666;">Brand</td><td style="font-weight:700; text-align:right;">RADHIKA</td></tr>
                <tr><td style="color:#666;">Category</td><td style="font-weight:700; text-align:right;" id="pCat">Fashion</td></tr>
                <tr><td style="color:#666;">Material</td><td style="font-weight:700; text-align:right;" id="pMaterial">Premium Quality</td></tr>
                <tr><td style="color:#666;">Delivery</td><td style="font-weight:700; text-align:right; color:var(--green);">Free Shipping</td></tr>
            </table>
        </div>
        <h4>Product Description</h4>
        <p id="pDesc" style="font-size: 14px; color: #555; line-height: 1.6;">Premium collection crafted for your comfort and style.</p>
        <div class="feedback-section">
            <h4 style="margin-bottom: 15px;">Customer Reviews (<span id="revCount">124</span>)</h4>
            <div id="feedbackContainer"></div>
        </div>
    </div>

    <div class="related-section">
        <h4 id="relatedTitle" style="margin-bottom: 15px;">More from this Category</h4>
        <div id="relatedGrid" class="related-grid"></div>
    </div>

    <div class="bottom-bar">
        <button class="btn btn-cart" id="addToCartBtn"><i class="fa-solid fa-cart-plus"></i> CART</button>
        <button class="btn btn-buy" id="buyNowBtn"><i class="fa-solid fa-bolt"></i> BUY NOW</button>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxKbWEBwz1sm4sftFM5yM-ako6ProOKTPEGtA_7zDqA8_LrJ-_KTXtCfsAIhfXqIlpy/exec";
        const params = new URLSearchParams(window.location.search);
        const productId = params.get('id');
        let currentProduct = null;
        let selectedSize = "";

        async function init() {
            // 1. Try Local Storage first
            const localProducts = JSON.parse(localStorage.getItem('myProducts')) || [];
            currentProduct = localProducts.find(x => x.id == productId);

            // 2. If not in local storage (shared link), fetch from Cloud
            if (!currentProduct) {
                try {
                    const response = await fetch(SCRIPT_URL);
                    const data = await response.json();
                    currentProduct = data.products.find(p => p.id == productId);
                    
                    // Save all products locally for 'Similar Products' to work
                    localStorage.setItem('myProducts', JSON.stringify(data.products));
                } catch (e) {
                    console.error("Fetch Error", e);
                }
            }

            if (currentProduct) {
                renderProduct(currentProduct);
                document.getElementById('loader').style.display = 'none';
            } else {
                alert("Product not found!");
                window.location.href = "index.html";
            }
        }

        function renderProduct(product) {
            document.getElementById('pName').innerText = product.name;
            document.getElementById('pPrice').innerText = 'â‚¹' + product.price;
            document.getElementById('pCat').innerText = product.category || "General";
            
            // Random Pricing UI
            const off = [30, 40, 50][Math.floor(Math.random()*3)];
            document.getElementById('pOff').innerText = off + "% OFF";
            document.getElementById('pOld').innerText = 'â‚¹' + Math.round(product.price / (1 - off/100));
            document.getElementById('avgRating').innerText = (Math.random() * (4.9 - 4.2) + 4.2).toFixed(1);

            // Gallery
            const mainImg = product.mainImg || product.img;
            document.getElementById('mainDisplay').src = mainImg;
            let photos = [mainImg];
            if(product.gallery) {
                const extra = Array.isArray(product.gallery) ? product.gallery : [product.gallery];
                photos = [...new Set([...photos, ...extra])];
            }
            photos.forEach((src, i) => {
                const thumb = document.createElement('div');
                thumb.className = `thumb-card ${i === 0 ? 'active' : ''}`;
                thumb.innerHTML = `<img src="${src}">`;
                thumb.onclick = () => {
                    document.getElementById('mainDisplay').src = src;
                    document.querySelectorAll('.thumb-card').forEach(t => t.classList.remove('active'));
                    thumb.classList.add('active');
                };
                document.getElementById('thumbRow').appendChild(thumb);
            });

            // Size Logic
            const cat = (product.category || "").toLowerCase();
            if(cat.includes('kurti') || cat.includes('dress') || cat.includes('western') || cat.includes('saree')) {
                const sizes = cat.includes('saree') ? ["Free Size"] : ["S", "M", "L", "XL", "XXL"];
                document.getElementById('sizeArea').style.display = 'block';
                sizes.forEach(sz => {
                    const btn = document.createElement('button');
                    btn.innerText = sz;
                    btn.style.cssText = "border:1px solid #ddd; padding:8px 15px; border-radius:6px; background:white; cursor:pointer; font-weight:600;";
                    btn.onclick = () => {
                        document.querySelectorAll('#sizeOptions button').forEach(b => { b.style.background="white"; b.style.color="black"; });
                        btn.style.background = "#f3047c"; btn.style.color = "white";
                        selectedSize = sz;
                    };
                    document.getElementById('sizeOptions').appendChild(btn);
                });
            }

            // Description
            document.getElementById('pDesc').innerText = cat.includes('saree') ? 
                "Premium collection fabric designed to give you an elegant look for every occasion." : 
                "Stylish design crafted keeping latest trends in mind with breathable fabric.";

            // Similar Products
            const allLocal = JSON.parse(localStorage.getItem('myProducts')) || [];
            const similar = allLocal.filter(p => p.category === product.category && p.id != product.id);
            similar.forEach(sp => {
                const item = document.createElement('div');
                item.className = 'rel-card';
                item.onclick = () => window.location.href = `details.html?id=${sp.id}`;
                item.innerHTML = `<img src="${sp.mainImg || sp.img}"><div style="padding:10px;"><div style="font-size:12px; font-weight:600;">${sp.name}</div><div style="color:var(--primary); font-weight:800;">â‚¹${sp.price}</div></div>`;
                document.getElementById('relatedGrid').appendChild(item);
            });

            // Reviews
            const names = ["Anjali S.", "Priya V.", "Mehak G."];
            for(let i=0; i<3; i++) {
                const rev = document.createElement('div');
                rev.className = 'review-card';
                rev.innerHTML = `<div class="review-header"><span class="reviewer-name">${names[i]}</span><span class="review-stars">â˜…â˜…â˜…â˜…â˜…</span></div><div class="review-text">Amazing quality! Loved it.</div>`;
                document.getElementById('feedbackContainer').appendChild(rev);
            }
        }

        // Action Buttons
        document.getElementById('addToCartBtn').onclick = () => {
            if (document.getElementById('sizeArea').style.display === "block" && !selectedSize) { alert("Please select a size! ðŸ“"); return; }
            let cart = JSON.parse(localStorage.getItem('myCart')) || [];
            cart.push({...currentProduct, size: selectedSize});
            localStorage.setItem('myCart', JSON.stringify(cart));
            window.location.href = 'cart.html';
        };

        document.getElementById('buyNowBtn').onclick = () => {
            if (document.getElementById('sizeArea').style.display === "block" && !selectedSize) { alert("Please select a size! ðŸ“"); return; }
            localStorage.setItem('buyNowItem', JSON.stringify({...currentProduct, size: selectedSize}));
            window.location.href = 'address.html';
        };

        init();
        const badge = JSON.parse(localStorage.getItem('myCart')) || [];
        if(badge.length > 0) { document.getElementById('badge').innerText = badge.length; document.getElementById('badge').style.display = 'flex'; }
    </script>

    <a href="https://wa.me/917240232365?text=I am interested in product ID: ${productId}" 
       style="position:fixed; bottom:85px; right:20px; background:#25d366; color:white; width:55px; height:55px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:28px; box-shadow:0 4px 10px rgba(0,0,0,0.3); z-index:1000; text-decoration:none;">
        <i class="fa-brands fa-whatsapp"></i>
    </a>
</body>
</html>